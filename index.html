<!DOCTYPE html>
<html>
  <title>Layla</title>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.1.1/normalize.css">
    <style>
      html, body {
        height: 100%;
        min-height: 100%;
      }

      body {
        background-color: rgba(0,0,0,.05);
      }

      .source {
        position: absolute;
        top: 0;
        bottom: 0;
        margin: 12px;
        font-family: "Menlo", "Monaco", "Consolas", "Courier New", monospace;
        color: #444;
        background-color: white;
        border: 1px solid rgba(0,0,0,.2);
        box-shadow: inset 2px 2px 2px rgba(0,0,0,.1);
        border-radius: 4px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .source textarea,
      .source .CodeMirror {
        font-family: inherit;
        font-size: 14px;
        outline: none;
        border: none;
        background: none;
        padding: 12px;
        flex-grow: 1;
        box-sizing: border-box;
        resize: none;
        color: inherit;
        cursor: text;
      }

      #lay {
        left: 0;
        right: 50%;
        margin-right: 6px;
      }

      #css {
        left: 50%;
        right: 0;
        margin-left: 6px;
      }

      .source > .errors {
        overflow: hidden;
        margin: 0;
        max-height: 0;
        background-color: #fdeeb1;
        transition: max-height .15s;
        border-top: 1px solid rgba(0,0,0,.2);
        box-shadow: 2px -2px 2px rgba(0,0,0,.1);
        margin-bottom: -4px
      }

      .source > .errors > p {
        font-size: 13px;
        color: rgba(255, 0, 0, .7);
        margin: 12px 12px 16px;
      }

      body.errored .source > .errors {
        max-height: 4em;
      }

      body.errored #css textarea,
      body.errored #css .CodeMirror{
        opacity: .3;
      }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/mode/css/css.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.css">

    <script src="layla.js"></script>
    <script>
      jQuery(function($) {
        var lay_editor = CodeMirror.fromTextArea($('#lay textarea')[0], {
          tabSize: 2,
          mode: 'text'
        });

        lay_editor.on('change', function() {
          lay_editor.save();
          $('#lay textarea').trigger('change');
        });

        var css_editor = CodeMirror.fromTextArea($('#css textarea')[0], {
          tabSize: 2,
          mode: 'css',
          readOnly: true
        });

        function compile() {
          var layla = new Layla;

          try {
            var css = layla.compile($('#lay textarea').val());
            $('#css textarea').val(css);
            css_editor.setValue(css);
            $('body').removeClass('errored');
          } catch (e) {
            $('body').addClass('errored');
            $('#lay > .errors').empty().append($('<p>').text(e.message));
          }
        }

        var toCompile;

        $('#lay textarea')
          .on('change keydown paste focus blur', function() {
            clearTimeout(toCompile);
            toCompile = setTimeout(compile, 500);
          })
          .focus();
      });
    </script>
  </head>
  <body>

    <div class="source" id="lay">
      <textarea spellcheck="false"></textarea>
      <div class="errors"></div>
    </div>

    <div class="source" id="css">
      <textarea readonly spellcheck="false"></textarea>
    </div>

  </body>
</html>
