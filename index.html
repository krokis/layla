<!DOCTYPE html>
<html>
  <title>Layla</title>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.1.1/normalize.css">
    <style>
      html, body {
        height: 100%;
        min-height: 100%;
      }

      body {
        background-color: rgba(0,0,0,.05);
      }

      .source {
        position: absolute;
        top: 0;
        bottom: 0;
        padding: 12px;
        font-family: "Menlo", "Monaco", "Consolas", "Courier New", monospace;
        color: #444;
      }

      .source textarea,
      .source .CodeMirror {
        font-family: inherit;
        font-size: 14px;
        outline: none;
        background-color: white;
        border: 1px solid rgba(0,0,0,.2);
        box-shadow: inset 2px 2px 2px rgba(0,0,0,.1);
        border-radius: 4px;
        padding: 12px;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        resize: none;
        color: inherit;
        cursor: text;
      }

      .source textarea:focus {
        box-shadow: inset 2px 2px 2px rgba(0,0,0,.1);
      }

      #lay {
        left: 0;
        right: 50%;
        padding-right: 6px;
      }

      #css {
        left: 50%;
        right: 0;
        padding-left: 6px;
      }

      body.errored #css {
        color: #cc0000;
      }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.css">
    <script src="layla.js"></script>
    <script>
      jQuery(function($) {
        function compile() {
          var layla = new Layla;
          try {
            $('#css textarea').val(layla.compile($('#lay textarea').val()));
            $('body').removeClass('errored');
          } catch (e) {
            $('body').addClass('errored');
            $('#css textarea').val(e.message);
          }
        }

        var toCompile;

        $('#lay textarea')
          .on('change keydown paste focus blur', function() {
            clearTimeout(toCompile);
            toCompile = setTimeout(compile, 500);
          })
          .focus();

        var editor = CodeMirror.fromTextArea($('#lay textarea')[0], {
          tabSize: 2
        });

        editor.on('change', function() {
          editor.save();
          $('#lay textarea').trigger('change');
        });
      });
    </script>
  </head>
  <body>

    <div class="source" id="lay">
      <textarea spellcheck="false"></textarea>
    </div>

    <div class="source" id="css">
      <textarea readonly spellcheck="false"></textarea>
    </div>

  </body>
</html>
